---
layout: article
title: C++ Primer 第4章 表达式
tags: 
    - 笔记
    - C++
---
第四章笔记
<!--more-->
## 4. 表达式
### 运算符
- **一元运算符**(unary operator) 作用于一个运算对象，&、*（解引用）等；
- **二元运算符**(binary operator) 作用域两个运算对象，==、*（乘法）等；
- **三元运算符** 条件运算符 ? :
- **函数调用** 对运算对象的数量没有限制。

**重载运算符**(overloaded operator) 为已存在的运算符赋予另外一层含义。如IO库的>>和<<、string对象、vector对象和迭代器使用的运算符。

**复合表达式**(compound expression) 指含有两个或多个运算符的表达式。根据优先级和结合律决定运算对象的组合方式。
![](image/2022-04-04-12-27-39.png)
![](image/2022-04-04-12-27-56.png)

**明确规定求值顺序的运算符**
- 逻辑与(&&)，当且仅当左侧运算对象为**真**时才对右侧运算对象求值；
- 逻辑或(\|\|)，当且仅当左侧运算对象为**假**时才对右侧运算对象求值；
- 条件(?: )，当条件为真时求:左侧表达式的值，条件为假时求:右侧表达式的值；
- 逗号(,)，首先对左侧的表达式求值，然后将求值结果丢弃掉，真正结果是右侧表达式的值。

**%运算符** 取余，参与取余的对象必须是整数类型。

**商为负数** C++11规定商一律向0取整（直接切除小数部分）。

**给赋值运算假括号** 赋值语句经常会出现在条件当中，因为赋值运算优先级较低，通常要给赋值部分加上括号。
```cpp
int i;
while((i = get_value()) != 42) {
      ...;
}
```

**递增、递减运算符**
如果不需要修改前的值，则使用前值版本，避免浪费和不必要的工作。
- 前置：++i，返回递增之后的值，将对象本身作为左值返回；
- 后置：i++，返回递增之前的值，将对象原始值的副本作为右值返回。

**成员访问运算符** 
- **点运算符**：获取类对象的一个成员；
- **箭头运算符**：作用于指针对象，相当于解引用后再访问成员。
```cpp
string s1 = "a string", *p = &s1;
auto n = s1.size();
n = (*p).size();
//等价于
n = p->size();
```

**嵌套条件运算符** 允许在条件运算符的内部嵌套 另外一个条件运算符。
```cpp
//将成绩分成三档
finalGrade = (grade > 90) ? "high pass"
                          : (grade < 60 ) ? "fail" : "pass";
```

### 位运算符
作用于整数类型的运算对象，并把运算对象看成是二进制位的集合。如果运算对象为“小整形”，则它的值会被自动提升成较大的整数类型。

**位移运算符**
- **左移运算符(<<)** 在右侧插入值为0的二进制位；
  - 左移动一位，若被舍弃的高位不为1，相当于乘以2
- **右移运算符(>>)** 取决于左侧运算对象的类型
  - 运算对象为无符号类型，再左侧插入值为0的二进制位；
  - 运算对象为带符号类型，再左侧插入符号位的副本或值为0的二进制位。
  - 右移一位，相当于除以2


**位求反运算符(~)** 将运算对象逐位求反后生成一个新值，将0置为1，将1置为0。

**位与、位或、位异或运算符**
- 位与运算符(&)
- 位或运算符(\|)
- 位异或运算(^)

### sizeof()运算符
返回一条表达式或一个类型名字所占的字节数。所得的值是一个size_t类型的常量表达式。

```cpp
sizeof(type);   //返回类型的大小

sizeof expr;    //返回表达式结果类型的大小
                //但并不实际计算其运算对象的值

sizeof *ptr;    //返回指针所指类型的空间大小
                //即使该指针是无效指针仍为安全行为
                
sizeof array;   //返回整个数组所占空间的大小
```

### 类型转换
**相互转换**(conversion) 某些类型之间有关联，可以相互转换。

**隐式转换**(implicit conversion) 自动执行的类型转换，无须程序员的介入。

**算术转换**(arithmetic conversion) 把一种算数类型转换成另一种算数类型。
- **整型提升**(integral promotion) 负责把小整数类型转换成较大的整数类型。
  bool、char 、unsigned char、short、unsigned short → int

**强制类型转换**(cast) 

命名的强制类型转换:
- **static_cast** 进行不包含底层const的具有明确定义的类型转换；
```cpp
int i, j;
double slope = static_cast<double>(j) / i;
```
- **dynamic_cast** 只能够用在指向类的指针或者引用上；
- **const_cast** 只能改变运算对象的底层const；
```cpp
const char *pc;
char *p = const_cast<char*>(pc);	//正确，但是通过p来写值是未定义的
```
- **reinterpret_cast** 为运算对象的位模式提供较低层次上的重新解释，能够完成任意指针类型向任意指针类型的转换，即使它们毫无关联。